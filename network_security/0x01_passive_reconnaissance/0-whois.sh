#!/bin/bash
whois "$1" | awk -F': +' 'BEGIN {split("Name;Organization;Street;City;State/Province;Postal Code;Country;Phone;Phone Ext:;Fax;Fax Ext:;Email", f, ";"); split("Registrant;Admin;Tech", t, ";")} {k=$1; v=$2; sub(/[ \t]+$/, "", v); d[k]=v} END {for(i=1;i<=3;i++) for(j=1;j<=12;j++) {kn=t[i]" "f[j]; lk=kn; sub(/:$/,"",lk); val=d[lk]; if(f[j]=="Street" && val!="") val=val" "; out=out kn "," val "\n"} printf "%s", substr(out, 1, length(out)-1)}' > "$1.csv"
